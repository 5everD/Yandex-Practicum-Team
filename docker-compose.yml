version: "3.9"

services:
    server:
      env_file:
        - .env
      build:
        context: .
        dockerfile: Dockerfile.server
        args:
          SERVER_PORT: ${SERVER_PORT}
      restart: always
      ports:
          - "${SERVER_PORT}:${SERVER_PORT}"
      depends_on:
        - postgres
      networks:
        - local

    postgres:
      container_name: ${POSTGRES_SERVICE_NAME}
      image: postgres:14
      env_file:
        - .env
      restart: always
      ports:
        - ${POSTGRES_PORT}:5432
      volumes:
        - ./tmp/pgdata:/var/lib/postgresql/data
      environment:
        PGDATA: /var/lib/postgresql/data/pgdata
        POSTGRES_HOST_AUTH_METHOD: trust
      networks:
        - local
        
    pgadmin:
      image: dpage/pgadmin4:4.18
      restart: always
      env_file:
        - .env
      environment:
        PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
        PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
        PGADMIN_LISTEN_PORT: ${PGADMIN_LISTEN_PORT}
      ports:
        - "${PGADMIN_PORT}:${PGADMIN_LISTEN_PORT}"
      user: '$UID:$GID'
      volumes:
        - ./tmp/pgadmin:/var/lib/pgadmin
      depends_on:
        - postgres
      networks:
        - local

networks:
  local:
    driver: bridge
