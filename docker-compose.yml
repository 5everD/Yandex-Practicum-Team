version: "3.9"

services:
    # client:
    #     container_name: prakticum-client
    #     image: prakticum-client
    #     build:
    #         context: .
    #         dockerfile: Dockerfile.client
    #         args:
    #           CLIENT_PORT: ${CLIENT_PORT}
    #     restart: always
    #     ports:
    #         - "${CLIENT_PORT}:80"
    #     environment:
    #       - CLIENT_PORT=${CLIENT_PORT}
    #       - SERVER_PORT=${SERVER_PORT}
    server:
      env_file:
        - .env
      build:
        context: .
        dockerfile: Dockerfile.server
        args:
          SERVER_PORT: ${SERVER_PORT}
      restart: always
      ports:
          - "${SERVER_PORT}:${SERVER_PORT}"
      depends_on:
        - postgres
      networks:
        - local

    postgres:
      container_name: ${POSTGRES_SERVICE_NAME}
      image: postgres:14
      env_file:
        - .env
      restart: always
      ports:
        - ${POSTGRES_PORT}:5432
      volumes:
        - ./tmp/pgdata:/var/lib/postgresql/data
      environment:
        PGDATA: /var/lib/postgresql/data/pgdata
        POSTGRES_HOST_AUTH_METHOD: trust
      networks:
        - local
        
    pgadmin:
      image: dpage/pgadmin4:4.18
      restart: always
      env_file:
        - .env
      environment:
        PGADMIN_DEFAULT_EMAIL: admin@admin.com
        PGADMIN_DEFAULT_PASSWORD: secret
        PGADMIN_LISTEN_PORT: 80
      ports:
        - "8080:80"
      user: '$UID:$GID'
      volumes:
        - ./tmp/pgadmin:/var/lib/pgadmin
      depends_on:
        - postgres
      networks:
        - local

networks:
  local:
    driver: bridge
